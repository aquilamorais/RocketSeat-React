<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Rubik&display=swap" rel="stylesheet">
  <title>RocketSeat - React - Fundamentos</title>
  <script src="https://unpkg.com/@tailwindcss/browser@4"></script>
  <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <style type="text/tailwindcss">
    @theme{
        --text: #EBEBEB;
        --text-secondary: #6b6b6b;
        --primary: #462878;
        --background: #2d2a37;
        
        --gradient: 180deg, 
        rgba(0, 0, 0, 0.05) 0%, 
        rgba(255, 255, 255, 0.05) 100%;
         
        --gradient-hover: 180deg, 
        rgba(0, 0, 0, 0.1) 0%, 
        rgba(255, 255, 255, 0.1) 100%;
         
        --shadow: 0px 11px 7px 0px rgba(0, 0, 0, 0.01), 
        0px 7px 7px 0px rgba(0, 0, 0, 0.04), 
        0px 4px 6px 0px rgba(0, 0, 0, 0.10), 
        0px 2px 4px 0px rgba(0, 0, 0, 0.26), 
        0px 0px 2px 0px rgba(0, 0, 0, 0.29), 
        0px 2px 3px 0px rgba(255, 255, 255, 0.06) inset;
         
        --font-sans: 'Rubik', sans-serif;
      }
    
    </style>
</head>

<!-- Pra usar as variaveis do @theme seguindo a sintaxe do Tailwind é preciso chamar a propriedade e depois colocar a variavel em (), por exemplo:
  font-(--font-sans)
-->

<body class="text-(--text) font-(--font-sans)">
  <div id="root"></div>

  <script type="text/babel">
    const textVariants = {
      default: 'text-xl',
      muted: 'text-xl text-(--text-secondary)',
      heading: 'text-2xl',
      blast: 'text-3xl'
    }

    //as = 'span', faz com que todo elemento html criado em Text seja do tipo span de forma padronizada, a menos que vc especifique o tipo na hora da criação.
    function Text({ as = 'span', variant = 'default',
      className, children, ...props }
    ) {
      return React.createElement(as, {
        className: `${textVariants[variant]} ${className}`,
        ...props
      },
        children)
      /* No createElement
      O primeiro parâmetro que pede é a tag q seria o 'as'
      Depois as propriedades ...props
      e o conteúdo dessa tag, o children
      */
    }



    function Button({ children, className, variant, ...props }) {
      return (
        <Text
          as="button"
          variant="heading"
          className={
            `flex items-center justify-center rounded-xl
            p-3 cursor-pointer text-(--text)
            bg-linear-(--gradient) hover:bg-linear-(--gradient-hover) shadow-(--shadow)
            ${buttonVariants[variant]}
            ${className ? className : ''}
            `
          }
          {...props}
        >
          {children}
        </Text>
      )
    }

    const buttonVariants = {
      primary: "bg-(--primary)",
      default: "bg-(--background)"
    }


    function Card({ children, className, ...props }) {
      return (
        <div
          className={`bg-(--background) shadoe-(--shadow)
            rounded-2xl ${className ? className : ''}`}
        >
          {children}
        </div>
      )
    }

    const buttons = [
      [
        { input: "CE" },
        { input: "C", className: "flex-1 h-16" },
        { input: "/", variant: "primary" }
      ],
      [
        { input: "7" },
        { input: "8" },
        { input: "9" },
        { input: "*", variant: "primary" }
      ],
      [
        { input: "4" },
        { input: "5" },
        { input: "6" },
        { input: "-", variant: "primary" }
      ],
      [
        { input: "1" },
        { input: "2" },
        { input: "3" },
        { input: "+", variant: "primary" }
      ],
      [
        { input: "0", className: "flex-1 h-16" },
        { input: "," },
        { input: "=", variant: "primary" }
      ]
    ]

    //função para mostrar no display o resultado
    function CalculatorDisplay({ result, operation }) {
      return (
        <div className={`flex flex-col gap-2 px-[1.375rem]
          cursor-default select-none  
            `} >
          <Text
            as="div"
            variant="muted"
            className="flex items-center justify-end h-7"
          >
            {result && operation}
          </Text>
          <div className={`flex items-center justify-between h-9
                `}>
            <Text variant="muted">=</Text>
            <Text variant="blast">{result || operation}</Text>
          </div>
        </div>
      )
    }

    //Aplicando o map() para gerar os botões da calculadora
    function Calculator() {

      const [operation, setOperation] = React.useState('');
      const [result, setResult] = React.useState('');
      //Função que ocorrerá toda a operação da calculadora
      function handleInputClick(input) {
        //Vai zerar a operação e o resultado, os estados ficarão vazios ao defenir que o setOperation e o setResult sejam ""
        //Nunca esqueça de dá return nos ifs
        if (input === "C") {
          setOperation("");
          setResult("");
          return;
        }

        //Vai zerar o resultado e voltará com a operação para o display de baixo, e o display retornará 2 caracteres.
        //slice() irá retornar nosso array de volta de acordo com a modificação q a gente utilizar. os dois parâmetros que ele pede são o início e o fim do array.
        //Queremos nossa operação deste o caractere no índice 0 da string e tire 2 caracteres da operação, por isso -2, para volta 2 índices.
        if (input === "CE") {
          setResult("");
          setOperation(operation.slice(0, -2));
          return;
        }

        //Ao pressionar o = a operação vai ser realizada pelo eval() e em seguida, vai transformar a , em um . caso a operação envolver decimais, e internacionalmente, os decimais são representados com .
        /*
          replace() irá converter a vírgula em ponto. /,/g -> pegará todas as vígulas ( /,/ dentro das barras para colocar o que quer selecionar) em escola global(g).
          '.' -> o elemento que irá substituir a vírgula selecionada.

          Na const parsedResult, irá pegar o valor de operationResult e transformará em string com o toString().
          O ? serve para continuar com o código mesmo que a operação da esquerda dê null ou undefined, que no caso será o replace de novo.
          Este replace() irá transformar o . em , novamente. O ponto sozinho entre as duas barras /./ não representa um ponto de fato dentro da string, e para resolver isso usa a barra invertida (\.)
        */
        if (input === "=") {
          const operationResult = eval(operation.replace(/,/g, '.'));
          const parsedResult = operationResult.toString()?.replace(/\./g, ',');
          setResult(parsedResult);
          return;
        }

        if (result) {
          setOperation(isNaN(input))
            ? `${result}${input === "," ? "" : " "}${input}`
            : input;
          setResult("");
          return;
        }

        if (input === "," && !operation.endsWith(',')) {
          setOperation(`${operation},`);
          return;
        }

        setOperation(`${operation}${operation.endsWith(',') ? "" : " "}${input}`)
      }

      return (
        <Card className={`flex flex-col gap-[1.625rem]
          w-[22.25rem] pt-14 px-8 pb-8
          `}>

          <CalculatorDisplay operation={operation} result={result} />

          <div className="flex flex-col gap-3">
            {buttons.map((row, index) => (
              /* 
              Dentro de map() vai ter uma arrow function com parâmetros "row" para indicar as linhas que vai ser organizado os buttons e o "index" para facilitar na ordem de mapeamento.
              O map() vai gerar divs de cada bloco de objeto definido na const buttons lá em cima.
              Cada div dessa terá uma key que vai ligar cada row com um index (para não perder a ordem, uma maneira q funciona para dados estáticos).
              
              Conforme vai gerando cada div, estas terão outro map() dentro delas.
              Esses map() terão uma variável button atribuída de uma arrow function, este button indica cada elemento/objeto que o map() mapeará da const buttons.
              Significa que, cada button se tornará um elemento button de fato por meio da função <Button></Button>.

              Dentro destes <Button>, terá como formatação uma condição curto-circuito ( || ) no className.
              Este className permite uma extesão de prop, em que se não tiver uma className já predefinida dentro desse objeto/elemento (como o botão 0, por exemplo que é maior e tem predefinido uma largura) o button terá como formato "w-16 h-16".
              Key={} terá button.input como forma de organizar o mapeamento, o valor de cada input dentro de cada button.
              variant={} terá como valor inicial o button.variant, ou seja, a variante que já tem de cada input.

              Por fim, dentro dos nossos Buttons, renderizará {button.input}, isto é, o valor de cada input que a variável button está pegando de cada elemento do objeto lá de const buttons
              */

              <div className="flex gap-3" key={`row-${index}`}>
                {row.map(button => (

                  <Button className={button.className || "w-16 h-16"}
                    key={button.input}
                    variant={button.variant}
                    onClick={
                      /*
                      Se chamar a função assim: onClick={HandleInputClick}
                      Não vai funcionar, porque a função tem o parâmetro "input".
                      Por isso é chamado por meio de uma arrow function
                      */
                      () => handleInputClick(button.input)
                    }
                  >
                    {button.input}
                  </Button>
                ))}
              </div>
            ))}
          </div>
        </Card>
      )
    }

    function App() {
      return (
        <main className={`py-28 px-4 flex flex-col sm:flex-row items-center
        sm:items-stretch gap-2
        sm:px-10  
          `}>
          <Calculator />
          <OperationHistory />
        </main>
      )
    }

    function OperationHistory() {
      return (
        <Card className="py-10 px-8 w-full">
          <Text className="mb-4"
            variant="heading"
            as="h1"
          >
            Histórico de Operações
          </Text>
          <ul className="flex flex-col gap-3">
            <Text as="li">1 + 1 = 2</Text>
            <Text as="li">13 * 1 = 13</Text>
            <Text as="li">1 + 5 = 6</Text>
          </ul>
        </Card>
      )
    }

    ReactDOM.createRoot(document.getElementById('root')).render(
      <App />
    )
  </script>
</body>

</html>